{% extends "base.html" %}
{% block title %}TransX| HARAMBEE COOP{% endblock %}
{% block content%}
<div class="container">
  <br>

   <div class="row">
       <!-- Display Statements -->
       <div class="col-md-12">
           <div id="statement">
            <div class="container-fluid">
               <div class="table-responsive">
                 <table class="table table-striped table-sm">
                  <form action="{{ url_for('reports') }}" method="post">
                  <h4>Customer Statement</h4>
                  <hr>
                  <label for="customer_id">MemberID:</label>
                  <input style="width: 25%;height: 30px;border: none; text-transform: uppercase; color: blue;" type="text" name="customer_id" id="customer_id" value="{{user_details.user_id|default('')}}">
                  <label for="customer_id">MemberName:</label>
                  <input style="width: 25%;height: 30px;border: none; text-transform: uppercase; color: blue;" type="text" name="customer_id" id="customer_id" value="{{user_details.narrative_beneficiary|default('')}}" >
                  <button type="submit" class="btn btn-primary">Print Statement</button>
                </form>
                  <thead>
                     <tr>
                       <th>Date</th>
                       <th>Purpose of Transaction</th>
                       <th>credit ID</th>
                       <th>Amount</th>
                     </tr>
                   </thead>
                   <tbody>
           <!--insert transactions-->  
                    {% for transaction in user_transactions%}
                     <tr>
                      <td style="color: rgb(138, 63, 2);" class="statement-data" type="text">{{ transaction.date.date() }}</td>
                      <td style="color: rgb(138, 63, 2);" class="statement-data" type="text">{{ transaction.transaction_purpose }}</td>
                      <td style="color: rgb(138, 63, 2);" class="statement-data" type="text">
                       {%if transaction.transaction_purpose=='Admin'%}
                            {{ transaction.narrative_beneficiary }}
                       {%elif transaction.transaction_purpose=='credit Disbursement'%}
                            {{ transaction.credit_id }}
                       {% endif %}
                      </td>
                      <td style="color: rgb(138, 63, 2);" class="statement-data" type="text">{{ "{:,.2f}".format(transaction.amount) }}</td>     
                    </tr> 
                    {% endfor %} 
                   </tbody>
                 </table>
                 <br>

                 <h4 >Transactions Summary</h4>
              
                 <div class="row row-cols-1 row-cols-md-4 mb-4 text-center">
                  {% for sum in transaction_sums %}
                  <div class="col">
                    <div class="card mb-4 rounded-3 shadow-sm">
                      <div class="card-header py-3" style="background-color: #b3ffd7;">
                        <h6 class="my-0 fw-normal">{{ sum.transaction_purpose }}</h6>
                      </div>
                      <div class="card-body state">
                        <h4 class="statement-data">{{ "{:,.2f}".format(sum.total_amount)}}</h4>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                 </div>
               </div>
           </div>
       </div>
   </div> 
  </div>
  
</div>
{% with messages = get_flashed_messages() %}
{% if messages %}
<script>
  var userConfirmed = confirm("{{ messages[0] }}");
  if (!userConfirmed) {
      // User clicked cancel, prevent the form submission
      document.querySelector('form').addEventListener('submit', function(event) {
          event.preventDefault();
      });
  }
</script>
{% endif %}
{% endwith %}
{% endblock %}